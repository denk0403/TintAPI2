<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dot Visualizer</title>
    <script>
        /** @param {SubmitEvent} event */
        function handleOnSubmit(event) {
            event.preventDefault();

            /** @type {HTMLFormElement} */
            const form = event.target;
            const formData = new FormData(form);
            const layout = formData.get("layout") ?? "sfdp";
            const format = formData.get("format") ?? "svg";
            const dot = formData.get("dot");

            const url = `/api/render-dot?layout=${layout}&format=${format}`;

            const loading = document.getElementById("loading");
            loading.hidden = false;

            fetch(url, { body: dot, method: "POST", })
                .then((res) => res.blob())
                .then((blob) => location.assign(URL.createObjectURL(blob)))
                .finally(() => { loading.hidden = true; });
        }
    </script>
    <style>
        form * {
            font-size: larger;
            box-sizing: border-box;
        }

        select {
            width: 250px;
            padding: 5px;
        }

        textarea {
            width: 500px;
            height: 400px;
            min-height: 250px;
            padding: 5px;
            resize: vertical;
        }

        button {
            width: 500px;
            height: 50px;
        }

        .loading-ring:not([hidden]) {
            --color: #0000ff;
            display: inline-block;
            vertical-align: middle;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            margin-left: 4px;
            border: 3px solid var(--color);
            border-color: var(--color) transparent var(--color) transparent;
            animation: loading-ring 1.2s linear infinite;
        }

        @keyframes loading-ring {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <form onsubmit="handleOnSubmit(event)">
        <select name="layout">
            <option selected value="sfdp">sfdp</option>
            <option value="dot">dot</option>
            <option value="circo">circo</option>
            <option value="fdp">fdp</option>
            <option value="neato">neato</option>
            <option value="osage">osage</option>
            <option value="patchwork">patchwork</option>
            <option value="twopi">twopi</option>
        </select>
        <select name="format">
            <option selected value="svg">SVG</option>
            <option value="png">PNG</option>
            <option value="jpg">JPG</option>
        </select>
        <br><br>
        <textarea name="dot" placeholder="graph test { }">graph test { a -- b }</textarea>
        <br><br>
        <button>Submit <div id="loading" class="loading-ring" hidden></div></button>
    </form>
</body>

</html>